worker_processes 4;

events {
    worker_connections 1024;
}


http {
    include mime.types;

    default_type application/octet-stream;
    sendfile on;
    keepalive_timeout 65;

    gzip_static on;
    gzip_proxied any;
    gzip on;
    gzip_disable "msie6";
    gzip_vary on;
    gzip_comp_level 6;
    gzip_buffers 16 8k;
    gzip_http_version 1.1;
    gzip_min_length 256;
    gzip_types
     text/plain
     text/css
     application/json
     application/x-javascript
     text/xml
     application/xml
     application/xml+rss
     text/javascript
     application/vnd.ms-fontobject
     application/x-font-ttf
     font/opentype
     image/svg+xml
     image/x-icon
     text/x-component
     application/javascript
     font/truetype
     font/opentype;

    error_log /var/log/nginx/error_log debug;
    access_log /var/log/nginx/access.log;

    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
    '$status $body_bytes_sent "$http_referer" '
    '"$http_user_agent" "$http_x_forwarded_for"';
    log_format compression '$remote_addr - $remote_user [$time_local] '
    '"$request" $status $body_bytes_sent '
    '"$http_referer" "$http_user_agent" "$gzip_ratio"';

    server {
        listen 80;
        server_name clamp-demo.sahajsoft.com www.clamp-demo.sahajsoft.com;
        return 301 https://clamp-demo.sahajsoft.com$request_uri;
    }

    server {
        listen 443 ssl ;
        server_name www.clamp-demo.sahajsoft.com;



        ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE
        ssl_prefer_server_ciphers on;
        ssl_certificate intranet-ssl-bundle.crt;
        ssl_certificate_key intranet_STAR_sahajsoft.com.key;
        ssl_ciphers
        'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-
        RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDS
        A-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES1
        28-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!3DES:!MD5:!PSK';

        return 301 https://clamp-demo.sahajsoft.com$request_uri;
    }

    server {
        listen 443 ssl ;
        server_name clamp-demo.sahajsoft.com;

        root /usr/share/nginx/html;
        index index.html;

        ssl_certificate intranet-ssl-bundle.crt;
        ssl_certificate_key intranet_STAR_sahajsoft.com.key;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_prefer_server_ciphers on;
        ssl_ciphers
        'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-
        RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDS
        A-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES1
        28-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!3DES:!MD5:!PSK';

        location / {
            try_files $uri /index.html;
        }



       location /api {
        client_max_body_size 50M;
        proxy_set_header  X-Real-IP $remote_addr;
        proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_pass http://clamp-api_web_1:3000;
    }
        location /auth {
        proxy_pass http://clamp-api_web_1:3000;
    }

    location /multimedia {
        proxy_http_version 1.1;
        proxy_buffering off;
        # proxy_ssl_session_reuse on; # enable this if you are internally connecting over SSL
        proxy_read_timeout 15m; # Default value is 60s which is not sufficient for MinIO.
        proxy_send_timeout 15m; # Default value is 60s which is not sufficient for MinIO.
        proxy_request_buffering off; # Disable any internal request bufferring.
        proxy_set_header Host $http_host;
        proxy_pass http://minio1:9000;
        client_max_body_size 50m; # To restrict file size to a specific value
    }

     location /studentimage {
        proxy_http_version 1.1;
        proxy_buffering off;
        # proxy_ssl_session_reuse on; # enable this if you are internally connecting over SSL
        proxy_read_timeout 15m; # Default value is 60s which is not sufficient for MinIO.
        proxy_send_timeout 15m; # Default value is 60s which is not sufficient for MinIO.
        proxy_request_buffering off; # Disable any internal request bufferring.
        proxy_set_header Host $http_host;
        proxy_pass http://minio1:9000;
        client_max_body_size 50m; # To restrict file size to a specific value
    }

    location /statuscsv {
        proxy_http_version 1.1;
        proxy_buffering off;
        # proxy_ssl_session_reuse on; # enable this if you are internally connecting over SSL
        proxy_read_timeout 15m; # Default value is 60s which is not sufficient for MinIO.
        proxy_send_timeout 15m; # Default value is 60s which is not sufficient for MinIO.
        proxy_request_buffering off; # Disable any internal request bufferring.
        proxy_set_header Host $http_host;
        proxy_pass http://minio1:9000;
        client_max_body_size 50m; # To restrict file size to a specific value
    }

    location /studentcsv {
        proxy_http_version 1.1;
        proxy_buffering off;
        # proxy_ssl_session_reuse on; # enable this if you are internally connecting over SSL
        proxy_read_timeout 15m; # Default value is 60s which is not sufficient for MinIO.
        proxy_send_timeout 15m; # Default value is 60s which is not sufficient for MinIO.
        proxy_request_buffering off; # Disable any internal request bufferring.
        proxy_set_header Host $http_host;
        proxy_pass http://minio1:9000;
        client_max_body_size 50m; # To restrict file size to a specific value
    }
    location /studentcollage {
        proxy_http_version 1.1;
        proxy_buffering off;
        # proxy_ssl_session_reuse on; # enable this if you are internally connecting over SSL
        proxy_read_timeout 15m; # Default value is 60s which is not sufficient for MinIO.
        proxy_send_timeout 15m; # Default value is 60s which is not sufficient for MinIO.
        proxy_request_buffering off; # Disable any internal request bufferring.
        proxy_set_header Host $http_host;
        proxy_pass http://minio1:9000;
        client_max_body_size 50m; # To restrict file size to a specific value
    }

    location /minio {
        proxy_http_version 1.1;
        proxy_buffering off;
        # proxy_ssl_session_reuse on; # enable this if you are internally connecting over SSL
        proxy_read_timeout 15m; # Default value is 60s which is not sufficient for MinIO.
        proxy_send_timeout 15m; # Default value is 60s which is not sufficient for MinIO.
        proxy_request_buffering off; # Disable any internal request bufferring.
        proxy_set_header Host $http_host;
        proxy_pass http://minio1:9000;
        client_max_body_size 50m; # To restrict file size to a specific value
    }

    # Fix to handle TinyMCE in Firefox
    location  ~ //(.*) {
        proxy_pass http://127.0.0.1/$1;
    }



    }

    include servers/*;
}
